"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const hslayout_1 = require("hslayout");
class Slider {
    constructor() {
        this.range = [];
        this.value = 0.5;
        this.pos = {
            mouse: -1,
            slider: 0
        };
        this.renderSlider = () => hslayout_1.m('.hs-slider-slot', [
            hslayout_1.m('.hs-slider-markers', this.range.map(this.renderMarker)),
            hslayout_1.m('.hs-slider-handle', { style: `left:${100 * this.value}%` })
        ]);
        this.renderMarker = (value, i, markers) => {
            const share = i / (markers.length - 1);
            const left = markers.length < 2 ? 0 : 100 * share;
            return hslayout_1.m('.hs-slider-marker', { style: `left: ${left}%` }, this.renderLabel(value));
        };
        this.renderLabel = (value) => hslayout_1.m('.hs-slider-label', value);
    }
    mousedown(e) {
        this.pos.mouse = e.clientX;
        this.pos.slider = this.value;
    }
    mousemove(e) {
        if (this.pos.mouse > 0) {
            const width = e.currentTarget.clientWidth;
            this.value = (e.clientX - this.pos.mouse) / width + this.pos.slider;
            this.notify(this.value);
            console.log(`${e.clientX} - ${this.pos.mouse} / ${width} + ${this.pos.slider}`);
        }
    }
    mouseup(e) {
        this.mousemove(e);
        this.pos.mouse = -1;
        this.value = this.notify(this.value);
    }
    notify(value) {
        if ((this.range.length > 1) && (typeof this.range[0] === 'string')) {
            const v = Math.floor(this.value * (this.range.length - 1) + 0.5);
            this.onchange(this.range[v]);
            return v / (this.range.length - 1);
        }
        else {
            const numRange = this.range;
            const v = Math.floor((numRange[0] * (1 - this.value) + numRange[1] * this.value) * 100) / 100;
            this.onchange(Math.min(this.range[1], Math.max(this.range[0], v)));
            return this.value;
        }
    }
    view(node) {
        const css = node.attrs.css || '';
        this.range = node.attrs.range || [];
        this.onchange = node.attrs.onchange;
        return hslayout_1.m(`.hs-slider ${css}`, {
            onmousedown: this.mousedown.bind(this),
            onmousemove: this.mousemove.bind(this),
            onmouseup: this.mouseup.bind(this)
        }, [this.renderSlider()]);
    }
}
exports.Slider = Slider;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2xpZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL1NsaWRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQTBDQSx1Q0FBb0M7QUFvQnBDO0lBQUE7UUFFWSxVQUFLLEdBQWdCLEVBQUUsQ0FBQztRQUN4QixVQUFLLEdBQVUsR0FBRyxDQUFDO1FBQ25CLFFBQUcsR0FBRztZQUNWLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDVCxNQUFNLEVBQUMsQ0FBQztTQUNYLENBQUM7UUFnQ0ssaUJBQVksR0FBRyxHQUFVLEVBQUUsQ0FDOUIsWUFBQyxDQUFDLGlCQUFpQixFQUFFO1lBQ2pCLFlBQUMsQ0FBQyxvQkFBb0IsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDMUQsWUFBQyxDQUFDLG1CQUFtQixFQUFFLEVBQUUsS0FBSyxFQUFFLFFBQVEsR0FBRyxHQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO1NBQy9ELENBQUMsQ0FBQTtRQUVDLGlCQUFZLEdBQUcsQ0FBQyxLQUFvQixFQUFFLENBQVEsRUFBRSxPQUFtQixFQUFRLEVBQUU7WUFDaEYsTUFBTSxLQUFLLEdBQUcsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyQyxNQUFNLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxHQUFDLENBQUMsQ0FBQSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUMsS0FBSyxDQUFDO1lBQzdDLE9BQU8sWUFBQyxDQUFDLG1CQUFtQixFQUFFLEVBQUMsS0FBSyxFQUFFLFNBQVMsSUFBSSxHQUFHLEVBQUMsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDdEYsQ0FBQyxDQUFBO1FBRU0sZ0JBQVcsR0FBRyxDQUFDLEtBQW9CLEVBQVEsRUFBRSxDQUNoRCxZQUFD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